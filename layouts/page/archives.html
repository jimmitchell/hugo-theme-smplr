{{ define "main" }}
<div class="container">
    <h1>{{ .Title }}</h1>
    {{ .Content }}

    {{ $posts := where .Site.RegularPages "Section" "posts" }}
    {{ if not $posts }}{{ $posts = .Site.RegularPages }}{{ end }}
    {{ if $posts }}
        {{ $grouped := $posts.GroupByDate "2006" }}
        {{ if gt (len $grouped) 0 }}
        <div class="archive-filter">
            <label for="year-filter">Filter by year:</label>
            <select id="year-filter" class="year-filter-select">
                <option value="all">All years</option>
                {{ range $grouped }}
                <option value="year-{{ .Key }}">{{ .Key }}</option>
                {{ end }}
            </select>
        </div>
        <script>
        (function() {
            const yearFilter = document.getElementById('year-filter');
            if (!yearFilter) return;
            yearFilter.addEventListener('change', function() {
                const selectedYear = this.value;
                document.querySelectorAll('.archive-year').forEach(function(year) {
                    year.style.display = (selectedYear === 'all' || year.getAttribute('data-year') === selectedYear) ? '' : 'none';
                });
            });
        })();
        </script>
        {{ end }}

        <div class="archive-section">
            {{ range $grouped }}
            <div class="archive-year" data-year="year-{{ .Key }}">
                <h2>{{ .Key }}</h2>
                <ul class="archive-list">
                    {{ range .Pages }}
                    <li>
                        <a href="{{ .Permalink }}">{{ .Title }}</a>
                        <time datetime="{{ .Date.Format "2006-01-02" }}">{{ .Date.Format "Jan 2" }}</time>
                    </li>
                    {{ end }}
                </ul>
            </div>
            {{ end }}
        </div>
    {{ else }}
        <div class="archive-section">
            <p>No posts to display in archive.</p>
        </div>
    {{ end }}
</div>
{{ end }}
