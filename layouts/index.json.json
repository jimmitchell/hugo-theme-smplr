{
  "documents": [
    {{- $pages := .Site.RegularPages -}}
    {{- range $index, $page := $pages -}}
    {{- if $index }},{{ end }}
    {
      "id": {{ $index }},
      "title": {{ $page.Title | jsonify }},
      "content": {{ $page.Content | plainify | jsonify }},
      "url": {{ $page.Permalink | jsonify }},
      "summary": {{ cond (eq (trim ($page.Summary | plainify) " ") "") (truncate 300 ($page.Content | plainify)) ($page.Summary | plainify) | jsonify }},
      "date": {{ $page.Date.Format "2006-01-02" | jsonify }},
      "dateFormatted": {{- $day := $page.Date.Format "2" -}}{{- $dayInt := int $day -}}{{- $suffix := "th" -}}{{- if or (eq $dayInt 1) (eq $dayInt 21) (eq $dayInt 31) }}{{ $suffix = "st" }}{{ else if or (eq $dayInt 2) (eq $dayInt 22) }}{{ $suffix = "nd" }}{{ else if or (eq $dayInt 3) (eq $dayInt 23) }}{{ $suffix = "rd" }}{{ end -}}{{ printf "%s %d%s, %s" ($page.Date.Format "Monday, January") $dayInt $suffix ($page.Date.Format "2006") | jsonify }}
    }
    {{- end -}}
  ]
}
